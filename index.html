<!DOCTYPE html>
<html lang="ko" data-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JJTR-DEMO 계산기 v2</title>
  <style>
    :root{
      --bg:#f8f9fa; --fg:#212529; --muted:#6c757d; --card:#ffffff; --border:#dee2e6; --accent:#0d6efd; --accent-2:#5c7cfa; --warning:#e03131; --table-head:#f1f3f5; --shadow:0 4px 16px rgba(0,0,0,.06);
    }
    [data-theme="dark"]:root, @media (prefers-color-scheme:dark){
      --bg:#0f1115; --fg:#e6e6e6; --muted:#9aa0a6; --card:#151821; --border:#2a2f3a; --accent:#4c8dff; --accent-2:#7b9dff; --warning:#ff6b6b; --table-head:#1a1f2b; --shadow:0 8px 24px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    body{margin:0; padding:16px; font-family:"Inter", "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background:var(--bg); color:var(--fg);}
    .container{max-width:980px; margin:0 auto;}
    header{display:flex; align-items:center; justify-content:space-between; margin-bottom:16px}
    h1{margin:0; font-size:20px; font-weight:700}
    .toolbar{display:flex; gap:8px; align-items:center}
    .btn{appearance:none; border:1px solid var(--border); background:var(--card); color:var(--fg); padding:10px 12px; border-radius:10px; cursor:pointer; font-size:14px; box-shadow:var(--shadow);}
    .btn.primary{background:linear-gradient(180deg, var(--accent), var(--accent-2)); color:white; border:none}
    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px}
    .grid{display:grid; grid-template-columns:repeat(6,1fr); gap:12px}
    .grid .field{grid-column:span 3}
    @media (max-width:720px){ .grid{grid-template-columns:repeat(2,1fr)} .grid .field{grid-column:span 2} }
    label{display:block; font-size:12px; color:var(--muted); margin:0 0 6px 4px}
    input, select{width:100%; padding:12px; border-radius:12px; border:1px solid var(--border); background:var(--bg); color:var(--fg); font-size:14px}
    .section-title{margin:22px 0 8px; font-size:15px; font-weight:700; color:var(--muted)}
    table{width:100%; border-collapse:collapse; border-radius:12px; overflow:hidden; background:var(--card); box-shadow:var(--shadow)}
    th,td{border-bottom:1px solid var(--border); padding:10px 8px; text-align:center; font-size:13px}
    thead th{background:var(--table-head); color:var(--fg);}
    .stop-loss{color:var(--warning); font-weight:700}
    .summary{display:flex; gap:16px; flex-wrap:wrap; margin-top:8px; color:var(--muted); font-size:13px}
    .pill{padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:var(--bg); color:var(--fg)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>JJTR-DEMO 계산기 v2</h1>
      <div class="toolbar">
        <button class="btn" id="themeToggle">🌓</button>
      </div>
    </header>
    <div class="card">
      <div class="grid">
        <div class="field"><label>TR 값 (달러)</label><input type="number" id="tr" value="3.16" step="0.01"></div>
        <div class="field"><label>기준가</label><input type="number" id="basePrice" value="3358.49" step="0.01"></div>
        <div class="field"><label>총 자본금 ($)</label><input type="number" id="capital" value="10000" step="100"></div>
        <div class="field"><label>리스크 비율 (%)</label><input type="number" id="riskPercent" value="1" step="0.1"></div>
        <div class="field"><label>1 lot $1 움직임 손익 ($)</label><input type="number" id="dollarsPer1USDMove" value="100" step="1"></div>
      </div>
      <button class="btn primary" id="calcBtn">계산하기</button>
    </div>
    <div id="tableWrap35" class="section" style="display:none">
      <div class="section-title">● 구간 1 ~ 손절가 (3.5 TR)</div>
      <table id="zoneTable35"><thead><tr><th>구간</th><th>롱 진입가</th><th>숏 진입가</th><th>비중 (lot)</th></tr></thead><tbody></tbody></table>
      <div class="summary" id="summary35"></div>
    </div>
    <div id="tableWrap55" class="section" style="display:none">
      <div class="section-title">● 구간 1 ~ 손절가 (5.5 TR)</div>
      <table id="zoneTable55"><thead><tr><th>구간</th><th>롱 진입가</th><th>숏 진입가</th><th>비중 (lot)</th></tr></thead><tbody></tbody></table>
      <div class="summary" id="summary55"></div>
    </div>
  </div>
  <script>
    const els={tr:tr,basePrice:basePrice,capital:capital,riskPercent:riskPercent,dollarsPer1USDMove:dollarsPer1USDMove,calcBtn:calcBtn,table35:zoneTable35.querySelector('tbody'),table55:zoneTable55.querySelector('tbody'),summary35:summary35,summary55:summary55,tableWrap35:tableWrap35,tableWrap55:tableWrap55};
    const fmt2=n=>Number(n).toFixed(2);
    function calculateZones(){
      const base=parseFloat(els.basePrice.value),trv=parseFloat(els.tr.value),cap=parseFloat(els.capital.value),risk=parseFloat(els.riskPercent.value),dpum=parseFloat(els.dollarsPer1USDMove.value);
      const totalLoss=(cap*risk)/100;
      const presets=[3.5,5.5];
      els.table35.innerHTML='';els.table55.innerHTML='';
      function build(N){
        const zones=[];for(let i=0;i<=Math.floor(N);i++){zones.push([`구간 ${i+1} (${i} TR)`,i,false]);}zones.push([`손절가 (${fmt2(N)} TR)`,N,true]);return zones;
      }
      function render(tbody,summary,N){
        const zones=build(N),active=zones.filter(z=>!z[2]),perLoss=totalLoss/active.length;let sumLots=0;
        const stopLong=base-trv*N;const zone1Long=base-trv*0;const zoneDiff=Math.abs(stopLong-zone1Long);
        zones.forEach(([label,mult,isStop])=>{
          const longE=isStop?stopLong:(base-trv*mult);const shortE=isStop?(base+trv*N):(base+trv*mult);
          let lot='';if(!isStop){const dist=trv*(N-mult);const l=perLoss/(dist*dpum);sumLots+=l;lot=fmt2(l);}
          tbody.innerHTML+=`<tr><td class="${isStop?'stop-loss':''}">${label}</td><td class="${isStop?'stop-loss':''}">${fmt2(longE)}</td><td class="${isStop?'stop-loss':''}">${fmt2(shortE)}</td><td class="${isStop?'stop-loss':''}">${isStop?'':lot}</td></tr>`;
        });
        summary.innerHTML=`<span class="pill">총 허용손실: $${fmt2(totalLoss)}</span><span class="pill">총 비중(합계): ${fmt2(sumLots)} lot</span><span class="pill">구간폭: ${fmt2(zoneDiff)}</span>`;
      }
      presets.forEach(N=>{if(N===3.5){els.tableWrap35.style.display='';render(els.table35,els.summary35,N);}else{els.tableWrap55.style.display='';render(els.table55,els.summary55,N);}});
    }
    els.calcBtn.addEventListener('click',calculateZones);
    calculateZones();
  </script>
</body>
</html>
